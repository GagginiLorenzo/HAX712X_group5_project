{
  "hash": "ac6826c2bc8dc90adcbbcf5416caf4be",
  "result": {
    "markdown": "::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nfrom datetime import datetime\nimport matplotlib.pyplot as plt\nimport matplotlib.gridspec as gridspec\nimport requests\n\n#supprimer les warnings\npd.options.mode.chained_assignment = None  # default='warn'\n\n#%%\nurl = \"https://services9.arcgis.com/7Sr9Ek9c1QTKmbwr/arcgis/rest/services/mesures_occitanie_journaliere_poll_princ/FeatureServer/0/query?where=1%3D1&outFields=nom_com,nom_station,code_station,typologie,nom_poll,valeur,date_debut,influence&outSR=4326&f=json\"\n\nresponse = requests.get(url)\n\nif response.status_code == 200:\n    data = response.json()\nelse:\n    print(f\"La requête a échoué avec le code d'état {response.status_code}\")\n\n\n#%%\nrecords = data.get('features', [])\nrecords_data = [record['attributes'] for record in records]\ndf_atmo = pd.DataFrame(records_data)\n\n# %%\ndf_atmo[\"date_debut\"] = df_atmo[\"date_debut\"]/1000\ndf_atmo[\"date_debut\"] = df_atmo[\"date_debut\"].apply(\n            lambda _: datetime.utcfromtimestamp(_)\n        )\n# nettoyage df\n#df = df.drop([\"date_fin\", \"statut_valid\", \"x_l93\", \"y_l93\", \"geom\", \"metrique\"], axis=1)\n\n# liste des villes et des polluants\nvilles = df_atmo[\"nom_com\"].unique().tolist()\nvilles.sort()\npolluants = df_atmo[\"nom_poll\"].unique().tolist()\npolluants.sort()\ndf_atmo\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nC:\\Users\\hp\\AppData\\Local\\Temp\\ipykernel_11324\\2691145479.py:30: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).\n  lambda _: datetime.utcfromtimestamp(_)\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>nom_com</th>\n      <th>nom_station</th>\n      <th>code_station</th>\n      <th>typologie</th>\n      <th>nom_poll</th>\n      <th>valeur</th>\n      <th>date_debut</th>\n      <th>influence</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>MONTPELLIER</td>\n      <td>Montpellier - Prés d Arènes Urbain</td>\n      <td>FR50200</td>\n      <td>Urbaine</td>\n      <td>O3</td>\n      <td>69.3</td>\n      <td>2023-08-07</td>\n      <td>Fond</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>MONTPELLIER</td>\n      <td>Montpellier - Prés d Arènes Urbain</td>\n      <td>FR50200</td>\n      <td>Urbaine</td>\n      <td>O3</td>\n      <td>66.7</td>\n      <td>2023-08-08</td>\n      <td>Fond</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>MONTPELLIER</td>\n      <td>Montpellier - Prés d Arènes Urbain</td>\n      <td>FR50200</td>\n      <td>Urbaine</td>\n      <td>O3</td>\n      <td>65.4</td>\n      <td>2023-08-09</td>\n      <td>Fond</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>MONTPELLIER</td>\n      <td>Montpellier - Prés d Arènes Urbain</td>\n      <td>FR50200</td>\n      <td>Urbaine</td>\n      <td>O3</td>\n      <td>72.8</td>\n      <td>2023-08-10</td>\n      <td>Fond</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>MONTPELLIER</td>\n      <td>Montpellier - Prés d Arènes Urbain</td>\n      <td>FR50200</td>\n      <td>Urbaine</td>\n      <td>O3</td>\n      <td>54.0</td>\n      <td>2023-08-11</td>\n      <td>Fond</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>995</th>\n      <td>SAINT-GELY-DU-FESC</td>\n      <td>Montpellier Nord - Périurbain</td>\n      <td>FR50204</td>\n      <td>Périurbaine</td>\n      <td>O3</td>\n      <td>44.1</td>\n      <td>2022-10-29</td>\n      <td>Fond</td>\n    </tr>\n    <tr>\n      <th>996</th>\n      <td>SAINT-GELY-DU-FESC</td>\n      <td>Montpellier Nord - Périurbain</td>\n      <td>FR50204</td>\n      <td>Périurbaine</td>\n      <td>O3</td>\n      <td>53.2</td>\n      <td>2022-10-30</td>\n      <td>Fond</td>\n    </tr>\n    <tr>\n      <th>997</th>\n      <td>SAINT-GELY-DU-FESC</td>\n      <td>Montpellier Nord - Périurbain</td>\n      <td>FR50204</td>\n      <td>Périurbaine</td>\n      <td>O3</td>\n      <td>65.7</td>\n      <td>2022-10-31</td>\n      <td>Fond</td>\n    </tr>\n    <tr>\n      <th>998</th>\n      <td>BEZIERS</td>\n      <td>Beziers Leclerc trafic</td>\n      <td>FR50226</td>\n      <td>Urbaine</td>\n      <td>PM10</td>\n      <td>8.6</td>\n      <td>2023-08-30</td>\n      <td>Trafic</td>\n    </tr>\n    <tr>\n      <th>999</th>\n      <td>BEZIERS</td>\n      <td>Beziers Leclerc trafic</td>\n      <td>FR50226</td>\n      <td>Urbaine</td>\n      <td>PM10</td>\n      <td>9.4</td>\n      <td>2023-08-31</td>\n      <td>Trafic</td>\n    </tr>\n  </tbody>\n</table>\n<p>1000 rows × 8 columns</p>\n</div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "occitanie_files\\figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}