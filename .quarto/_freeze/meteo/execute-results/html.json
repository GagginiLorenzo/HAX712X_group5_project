{
  "hash": "c9c28670d1cbe4baa9cb444e98b4de1c",
  "result": {
    "markdown": "---\ntitle: ...\n---\n\n\n::: {.cell execution_count=1}\n``` {.python .cell-code code-fold=\"true\"}\nimport numpy as np\n\nimport requests\nimport datetime\nimport pooch\nimport PIL as Image\nimport statistics\nfrom dateutil.relativedelta import relativedelta\n\n# initialisation des dates de debut et fin d'extraction de données\ndate_debut = datetime.datetime.now() - relativedelta(days=2)\ndate_fin = date_debut + relativedelta(days=6)\n# formatage des dates pour importer le bon URL\ndate_debut_formattee = date_debut.strftime('%Y-%m-%d') \ndate_fin_formattee = date_fin.strftime('%Y-%m-%d')  \n\n# copie de l'URL du site open-meteo avec les differents critères qui nous interessent\nurl = f\"https://api.open-meteo.com/v1/meteofrance?latitude=43.6109&longitude=3.8763&hourly=temperature_2m,weathercode,precipitation&daily=weathercode,temperature_2m_max,temperature_2m_min,wind_speed_10m_max,precipitation_sum&timezone=Europe%2FLondon&start_date={date_debut_formattee}&end_date={date_fin_formattee}\"\n\n# récuperation des données\nresponse = requests.get(url)\ndata = response.json()\n\n\n# initialisation des tableaux de données que nous allons utiliser\ntemp = data[\"hourly\"][\"temperature_2m\"]\nprecipitation = data[\"daily\"][\"precipitation_sum\"]\nprecipitation_h = data[\"hourly\"][\"precipitation\"]\nwind = data[\"daily\"][\"wind_speed_10m_max\"]\ntempmin = data[\"daily\"][\"temperature_2m_min\"]\ntempmax = data[\"daily\"][\"temperature_2m_max\"]\ncodeimage = data[\"hourly\"][\"weathercode\"]\ncodeimagetot = data[\"daily\"][\"weathercode\"]\n\n\ndef index(i):\n    \n    jours_semaine = [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"]\n    return jours_semaine[(datetime.datetime.now().weekday() + i) % 7]\n\ndef date(i):\n    \n    d = datetime.datetime.now() + relativedelta(days=i)\n    return f\"{d.day}-{d.month}-{d.year}\"\n\n\ndef imgcodeday(i):\n    \"\"\"\n    Association de chaque code WBO à un pictogramme correspondant. Retourne le chemin d'accès au pictogramme par une chaîne de caractères. Version daily.\n    \"\"\"\n    code = codeimagetot[i]\n\n    if code == 0:\n        return \"icon/wi-day-sunny.svg\"\n    elif code == 1:\n        return \"icon/wi-day-sunny-overcast.svg\"\n    elif code == 2:\n        return \"icon/wi-day-cloudy.svg\"\n    elif code == 3:\n        return \"icon/wi-cloud.svg\"\n    elif code in [45, 48]:\n        return \"icon/wi-fog.svg\"\n    elif code in [51, 53, 55, 56, 57]:\n        return \"icon/wi-sprinkle.svg\"\n    elif code in [61, 81, 82]:\n        return \"icon/wi-showers.svg\"\n    elif code == 63:\n        return \"icon/wi-rain-wind.svg\"\n    elif code in [65, 66, 67]:\n        return \"icon/wi-rain.svg\"\n    elif code in [71, 73, 75, 85, 86]:\n        return \"icon/wi-snow.svg\"\n    elif code in [95, 96]:\n        return \"icon/wi-storm-showers.svg\"\n    elif code == 99:\n        return \"icon/wi-thunderstorm.svg\"\n    else:\n        return \"icon/wi-moon-new.svg\"\n\n# Remplace la première boucle for avec une list comprehension\nprecipitation_h = [0 if value is None else value for value in precipitation_h]\n\n# Calcule la somme des 24 dernières valeurs de precipitation_h\nprecipitationd = sum(precipitation_h[-24:])\n\n\n\ndef goutte(i):\n    \n    \"\"\"\n    Retourne une image sous format HTML correspondant à l'intensité des précipitations.\n    \"\"\"\n    if not isinstance(precipitation[i], float):\n        return \"\"\n\n    intensity = precipitation[i]\n\n    if 0 < intensity <= 2:\n        return f'<img src=\"icon/wi-raindrop.svg\" width=\"20\" height=\"20\" />'\n    elif intensity > 2:\n        return f'<img src=\"icon/wi-raindrops.svg\" width=\"40\" height=\"40\" />'\n    else:\n        return \"\"                  \nfrom IPython.display import HTML\nfrom tabulate import tabulate\n\n# Créez des classes pour styliser le tableau HTML\nres = f\"\"\"\n<table class=\"weather-table\">\n    <thead>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"style.css\">\n\n    <tr>\n        <th class=\"day-header\">Days</th>\n        <th class=\"day-cell\">{index(-2)}<br><small>{date(-2)}</small></th>\n        <th class=\"day-cell\">{index(-1)}<br><small>{date(-1)}</small></th>\n        <th class=\"day-cell\"> Today <br><small>{date(0)}</small></th>\n        <th class=\"day-cell\">{index(1)}<br><small>{date(1)}</small></th>\n        <th class=\"day-cell\">{index(2)}<br><small>{date(2)}</small></th>\n        <th class=\"day-cell\">{index(3)}<br><small>{date(3)}</small></th>\n        <th class=\"day-cell\">{index(4)}<br><small>{date(4)}</small></th>\n        \n    </tr>\n    </thead>\n    <tbody>\n    <tr class=\"temperature-row\">\n        <td> Temp Max (°C) </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">{tempmax[0]}°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">{tempmax[1]}°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">{tempmax[2]}°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">{tempmax[3]}°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">{tempmax[4]}°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">{tempmax[5]}°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">{tempmax[6]}°C </td>\n    </tr>\n    <tr class=\"temperature-row\">\n        <td>  Temp Min (°C) </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">{tempmin[0]}°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">{tempmin[1]}°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">{tempmin[2]}°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">{tempmin[3]}°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">{tempmin[4]}°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">{tempmin[5]}°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">{tempmin[6]}°C </td>\n       \n    </tr>\n    <tr class=\"wind-row\">\n        <td> Wind Speed Max  </td>\n        <td>{int(wind[0])} km/h </td>\n        <td>{int(wind[1])} km/h </td>\n        <td>{int(wind[2])} km/h </td>\n        <td>{int(wind[3])} km/h </td>\n        <td>{int(wind[4])} km/h </td>\n        <td>{int(wind[5])} km/h </td>\n        <td>{int(wind[6])} km/h </td>\n    </tr>\n    <tr class=\"precipitation-row\">\n        <td> Precipitation </td>\n        <td>{goutte(0)} {precipitation[0]} mm </td>\n        <td>{goutte(1)} {precipitation[1]} mm </td>\n        <td>{goutte(2)} {precipitation[2]} mm </td>\n        <td>{goutte(3)} {precipitation[3]} mm </td>\n        <td>{goutte(4)} {precipitation[4]} mm </td>\n        <td>{goutte(5)} {precipitation[5]} mm </td>\n        <td>{goutte(6)} {precipitationd} mm </td>\n    </tr>\n    </tbody>\n</table>\n\"\"\"\n\nHTML(res)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n\n<table class=\"weather-table\">\n    <thead>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"style.css\">\n\n    <tr>\n        <th class=\"day-header\">Days</th>\n        <th class=\"day-cell\">Tuesday<br><small>14-11-2023</small></th>\n        <th class=\"day-cell\">Wednesday<br><small>15-11-2023</small></th>\n        <th class=\"day-cell\"> Today <br><small>16-11-2023</small></th>\n        <th class=\"day-cell\">Friday<br><small>17-11-2023</small></th>\n        <th class=\"day-cell\">Saturday<br><small>18-11-2023</small></th>\n        <th class=\"day-cell\">Sunday<br><small>19-11-2023</small></th>\n        <th class=\"day-cell\">Monday<br><small>20-11-2023</small></th>\n        \n    </tr>\n    </thead>\n    <tbody>\n    <tr class=\"temperature-row\">\n        <td> Temp Max (°C) </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">24.3°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">19.8°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">18.6°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">16.9°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">16.5°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">18.8°C </td>\n       <td class=\"temp-cell\" style=\"background-color: rgba(255, 165, 80, 0.5); font-weight: bold;\">17.5°C </td>\n    </tr>\n    <tr class=\"temperature-row\">\n        <td>  Temp Min (°C) </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">15.0°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">10.4°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">7.7°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">10.2°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">6.1°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">6.8°C </td>\n        <td class=\"temp-cell\" style=\"background-color: rgba(144, 238, 144, 0.5); font-weight: bold;\">8.5°C </td>\n       \n    </tr>\n    <tr class=\"wind-row\">\n        <td> Wind Speed Max  </td>\n        <td>25 km/h </td>\n        <td>26 km/h </td>\n        <td>29 km/h </td>\n        <td>23 km/h </td>\n        <td>11 km/h </td>\n        <td>7 km/h </td>\n        <td>31 km/h </td>\n    </tr>\n    <tr class=\"precipitation-row\">\n        <td> Precipitation </td>\n        <td> 0.0 mm </td>\n        <td> 0.0 mm </td>\n        <td> 0.0 mm </td>\n        <td> 0.0 mm </td>\n        <td> 0.0 mm </td>\n        <td> 0.0 mm </td>\n        <td> 0.0 mm </td>\n    </tr>\n    </tbody>\n</table>\n```\n:::\n:::\n\n\n\n\n",
    "supporting": [
      "meteo_files\\figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}